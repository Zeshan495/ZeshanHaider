<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>For My Love üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Softer day gradient with pink + white */
      --bg-gradient-day: radial-gradient(circle at top, #fff5fb 0%, #ffe6f3 35%, #ffd4e8 65%, #ffedf8 100%);
      --bg-gradient-night: radial-gradient(circle at top, #1b1033 0%, #0b0718 45%, #02010a 100%);

      --card-bg-day: rgba(255, 255, 255, 0.7);
      --card-bg-night: rgba(9, 7, 30, 0.85);

      --card-border-day: rgba(255, 182, 193, 0.7);
      --card-border-night: rgba(255, 255, 255, 0.18);

      --text-main-day: #4a1035;
      --text-main-night: #f6ebff;

      --accent: #ff4b8a;
      --shadow-soft-day: 0 18px 40px rgba(0,0,0,0.18);
      --shadow-soft-night: 0 22px 50px rgba(0,0,0,0.75);

      --transition-fast: 180ms ease-out;
      --transition-med: 260ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient-day);
      color: var(--text-main-day);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      overflow-x: hidden;
      position: relative;
      transition: background var(--transition-med), color var(--transition-med);
    }

    body.theme-night {
      background: var(--bg-gradient-night);
      color: var(--text-main-night);
    }

    .glow-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.20), transparent 55%),
        radial-gradient(circle at 90% 10%, rgba(255,192,203,0.22), transparent 60%),
        radial-gradient(circle at 80% 90%, rgba(255,182,193,0.18), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.7;
      z-index: 0;
    }

    body.theme-night .glow-overlay {
      opacity: 0.55;
    }

    /* Floating glow name (ZA) */
    .name-glow {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      z-index: 0;
      mix-blend-mode: screen;
    }

    .name-glow span {
      position: absolute;
      font-size: clamp(3.8rem, 18vw, 9rem);
      font-weight: 700;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: rgba(255, 192, 203, 0.22);
      text-shadow:
        0 0 18px rgba(255,105,180,0.8),
        0 0 45px rgba(255,150,210,0.8);
      opacity: 0.75;
      animation: slowDrift 20s ease-in-out infinite alternate;
    }

    .name-glow .name-main {
      transform: translate(-10%, -14%) rotate(-12deg);
    }

    .name-glow .name-secondary {
      transform: translate(20%, 18%) rotate(10deg);
      opacity: 0.45;
      filter: blur(1px);
      animation-duration: 26s;
    }

    body.theme-night .name-glow span {
      color: rgba(255, 255, 255, 0.09);
      text-shadow:
        0 0 22px rgba(255,120,210,1),
        0 0 60px rgba(150,90,255,0.9);
    }

    @keyframes slowDrift {
      0% { transform: translate(-12%, -16%) rotate(-15deg); }
      100% { transform: translate(-6%, -8%) rotate(-10deg); }
    }

    .app {
      position: relative;
      z-index: 1;
      max-width: 780px;
      width: 100%;
    }

    .card {
      background: var(--card-bg-day);
      border-radius: 1.75rem;
      border: 1px solid var(--card-border-day);
      box-shadow: var(--shadow-soft-day);
      padding: 2.1rem 2.1rem 2.3rem;
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      position: relative;
      overflow: hidden;
      transition:
        background var(--transition-med),
        border-color var(--transition-med),
        box-shadow var(--transition-med),
        transform var(--transition-fast);
    }

    body.theme-night .card {
      background: var(--card-bg-night);
      border-color: var(--card-border-night);
      box-shadow: var(--shadow-soft-night);
    }

    @media (max-width: 640px) {
      .card {
        padding: 1.7rem 1.5rem 2rem;
        border-radius: 1.4rem;
      }
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.2rem;
    }

    @media (max-width: 640px) {
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.9rem;
      }
    }

    .card-header h1 {
      font-size: clamp(1.6rem, 2.1vw + 1.1rem, 2.2rem);
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 0.3rem;
    }

    .card-header p.subtitle {
      font-size: 0.95rem;
      opacity: 0.9;
      max-width: 25rem;
    }

    .card-header p.small-subtitle {
      font-size: 0.8rem;
      opacity: 0.85;
      margin-top: 0.15rem;
    }

    .card-controls {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .pill-btn {
      appearance: none;
      border-radius: 999px;
      border: 1px solid rgba(255,128,160,0.8);
      padding: 0.28rem 0.9rem;
      font-size: 0.8rem;
      background: rgba(255,255,255,0.6);
      color: inherit;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition:
        background var(--transition-fast),
        transform var(--transition-fast),
        border-color var(--transition-fast),
        box-shadow var(--transition-fast),
        opacity var(--transition-fast);
      white-space: nowrap;
    }

    .pill-btn:hover {
      background: rgba(255,255,255,0.9);
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
    }

    .pill-btn:active {
      transform: translateY(0);
      box-shadow: none;
      opacity: 0.9;
    }

    .content {
      display: grid;
      grid-template-columns: 1.45fr auto;
      gap: 1.7rem;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 680px) {
      .content {
        grid-template-columns: 1fr;
      }
    }

    .message-bubble {
      border-radius: 1.4rem;
      border: 1px solid rgba(255,182,193,0.9);
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,238,245,0.95));
      padding: 1rem 1.1rem 1.1rem;
      position: relative;
      overflow: hidden;
    }

    body.theme-night .message-bubble {
      background: linear-gradient(145deg, rgba(25,10,50,0.9), rgba(12,4,30,0.95));
      border-color: rgba(255,255,255,0.25);
    }

    .message-text {
      font-size: 1.03rem;
      line-height: 1.6;
      font-weight: 500;
      color: #4a1035;
      opacity: 0;
      transform: translateY(6px) scale(0.99);
      transition: opacity var(--transition-med), transform var(--transition-med);
      text-shadow: none;
      white-space: pre-wrap;
    }

    .message-text.visible {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    body.theme-night .message-text {
      color: #f7ecff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
    }

    /* ‚ú® Blinking cursor while typing */
    .message-text.typing::after {
      content: "‚ñå";
      display: inline-block;
      margin-left: 2px;
      animation: blinkCursor 0.8s steps(2, start) infinite;
      opacity: 0.9;
    }

    @keyframes blinkCursor {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }

    .message-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 0.6rem;
      font-size: 0.8rem;
      opacity: 0.85;
    }

    .message-meta strong {
      font-weight: 600;
    }

    /* Love level meter */
    .love-meter {
      margin-top: 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .love-meter-top {
      display: flex;
      justify-content: space-between;
      font-size: 0.78rem;
      opacity: 0.9;
    }

    .love-meter-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .love-meter-value {
      font-weight: 600;
    }

    .love-meter-bar {
      position: relative;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,192,203,0.4);
      overflow: hidden;
    }

    body.theme-night .love-meter-bar {
      background: rgba(255,255,255,0.12);
    }

    .love-meter-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #ffb6d4, #ff4b8a, #b3125d);
      box-shadow: 0 0 10px rgba(255,105,180,0.7);
      transition: width 220ms ease-out;
    }

    .love-meter-fill.full {
      box-shadow:
        0 0 12px rgba(255,105,180,0.9),
        0 0 18px rgba(255,150,210,0.9);
    }

    .hint-line {
      font-size: 0.84rem;
      margin-top: 0.55rem;
      opacity: 0.9;
    }

    .heart-panel {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.45rem;
    }

    .heart-button {
      width: 120px;
      height: 120px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      outline: none;
      background: radial-gradient(circle at 30% 20%, #ffe1f0, #ff4b8a);
      box-shadow:
        0 14px 28px rgba(0,0,0,0.35),
        0 0 0 6px rgba(255,255,255,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        filter var(--transition-fast);
    }

    .heart-button:hover {
      transform: translateY(-4px) scale(1.04);
      filter: brightness(1.05);
      box-shadow:
        0 20px 40px rgba(0,0,0,0.45),
        0 0 0 8px rgba(255,255,255,0.28);
    }

    .heart-button:active {
      transform: translateY(0);
      box-shadow:
        0 10px 20px rgba(0,0,0,0.4),
        0 0 0 3px rgba(255,255,255,0.24);
    }

    .heart-icon {
      width: 60px;
      height: 60px;
      display: block;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,0.35));
      transform-origin: center;
    }

    .heart-pulse {
      animation: heartPulse 440ms ease-out;
    }

    @keyframes heartPulse {
      0%   { transform: scale(1);   }
      40%  { transform: scale(1.18);}
      70%  { transform: scale(0.94);}
      100% { transform: scale(1);   }
    }

    .heart-hint {
      font-size: 0.82rem;
      opacity: 0.9;
    }

    /* ==== Special Dates + Timeline ==== */
    .special-dates {
      border-radius: 1rem;
      padding: 12px 15px 15px;
      margin: 4px 0 0;
      background: rgba(255,255,255,0.8);
      border: 1px solid rgba(255,182,193,0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-size: 0.93rem;
      line-height: 1.55;
      animation: fadeInDates 1.2s ease-out;
      color: #4a1035;
    }

    body.theme-night .special-dates {
      background: rgba(255,255,255,0.08);
      border-color: rgba(255,255,255,0.25);
      color: #f6ebff;
    }

    .special-dates .dates-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem 1.4rem;
      margin-bottom: 6px;
    }

    .special-dates .date-item {
      font-weight: 500;
    }

    .love-counter {
      font-size: 0.86rem;
      opacity: 0.95;
      margin-bottom: 4px;
    }

    .love-timeline {
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .timeline-track {
      position: relative;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffb6d4, #ff7fae, #ff4b8a);
      overflow: hidden;
      margin-bottom: 4px;
    }

    body.theme-night .timeline-track {
      background: linear-gradient(90deg, #ffd1ff, #ff9ae6, #ffa6d5);
      opacity: 0.9;
    }

    .timeline-heart {
      position: absolute;
      top: 50%;
      left: -10%;
      transform: translateY(-50%);
      animation: slideHeart 6s linear infinite;
      font-size: 1rem;
      text-shadow: 0 0 6px rgba(0,0,0,0.4);
    }

    @keyframes slideHeart {
      0%   { left: -10%; }
      100% { left: 105%; }
    }

    .timeline-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    @keyframes fadeInDates {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* üîî Upcoming event highlight */
    .upcoming-event {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 0.9rem;
      background: linear-gradient(135deg, rgba(255,244,249,0.95), rgba(255,225,240,0.95));
      border: 1px solid rgba(255,137,178,0.9);
      box-shadow: 0 10px 22px rgba(255,137,178,0.30);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    body.theme-night .upcoming-event {
      background: linear-gradient(135deg, rgba(33,12,60,0.95), rgba(60,18,90,0.95));
      border-color: rgba(255,189,231,0.85);
      box-shadow: 0 10px 22px rgba(0,0,0,0.45);
    }

    .upcoming-event .upcoming-title {
      font-size: 0.86rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 6px;
      justify-content: space-between;
    }

    .upcoming-event .upcoming-main {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .upcoming-event .upcoming-count {
      font-size: 0.85rem;
      opacity: 0.95;
    }

    .upcoming-event.today {
      border-width: 2px;
      box-shadow:
        0 0 0 2px rgba(255,255,255,0.8),
        0 12px 28px rgba(255,105,180,0.55);
    }

    .upcoming-event.today .upcoming-title {
      font-weight: 700;
    }

    .upcoming-soon {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255,192,203,0.9);
      color: #4a1035;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    body.theme-night .upcoming-soon {
      background: rgba(255,189,231,0.95);
      color: #2a0020;
    }

    .footer-note {
      margin-top: 1rem;
      font-size: 0.8rem;
      display: flex;
      justify-content: space-between;
      gap: 0.7rem;
      flex-wrap: wrap;
      opacity: 0.9;
    }

    .footer-note b {
      font-weight: 600;
    }

    /* Background floating hearts */
    .bg-hearts {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0.33;
    }

    .bg-heart-shape {
      position: absolute;
      font-size: 22px;
      animation: drift 18s linear infinite;
      opacity: 0.45;
    }

    .bg-heart-shape:nth-child(odd) {
      animation-duration: 22s;
    }

    @keyframes drift {
      0% {
        transform: translateY(100vh) rotate(-10deg);
      }
      100% {
        transform: translateY(-10vh) rotate(10deg);
      }
    }

    /* Click-floating hearts */
    .floating-heart {
      position: fixed;
      font-size: 1.15rem;
      pointer-events: none;
      user-select: none;
      z-index: 3;
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.7);
      animation: floatHeart 1.1s ease-out forwards;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.35));
    }

    @keyframes floatHeart {
      0% {
        opacity: 0;
        transform: translate(-50%, -20%) scale(0.7);
      }
      15% {
        opacity: 1;
        transform: translate(-50%, -60%) scale(1.05);
      }
      60% {
        opacity: 1;
        transform: translate(-50%, -140%) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -210%) scale(0.9);
      }
    }

    /* ==== Fireworks for Birthday ==== */
    .fireworks-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 4;
      overflow: hidden;
      display: none;
    }

    body.birthday-today .fireworks-container {
      display: block;
    }

    .firework {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: transparent;
      box-shadow:
        0 0 0 0 rgba(255,255,255,0.9),
        0 0 0 0 rgba(255,183,197,0.9),
        0 0 0 0 rgba(255,255,153,0.9);
      animation: explode 1.4s ease-out infinite;
    }

    @keyframes explode {
      0% {
        transform: translate(-50%, -50%) scale(0.4);
        opacity: 1;
        box-shadow:
          0 0 0 0 rgba(255,255,255,0.9),
          0 0 0 0 rgba(255,183,197,0.9),
          0 0 0 0 rgba(255,255,153,0.9);
      }
      60% {
        opacity: 1;
        box-shadow:
          0 -35px 0 2px rgba(255,255,255,0.95),
          30px 20px 0 2px rgba(255,183,197,0.95),
          -25px 25px 0 2px rgba(255,255,153,0.95);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(1.1);
        box-shadow:
          0 -50px 0 1px rgba(255,255,255,0),
          40px 25px 0 1px rgba(255,183,197,0),
          -35px 35px 0 1px rgba(255,255,153,0);
      }
    }
  </style>
</head>

<body>
  <div class="glow-overlay"></div>
  <div class="name-glow" aria-hidden="true">
    <span class="name-main">ZA</span>
    <span class="name-secondary">ZA</span>
  </div>
  <div class="bg-hearts" id="bgHearts"></div>
  <div class="fireworks-container" id="fireworks"></div>

  <main class="app">
    <section class="card" aria-label="Love messages for ZA">
      <div class="card-header">
        <div>
          <h1>For Golu, üíñ</h1>
          <p id="greetingLine" class="subtitle small-subtitle"></p>
        </div>
        <div class="card-controls">
          <button id="themeToggle" class="pill-btn" type="button">
            üåô Night mode
          </button>
        </div>
      </div>

      <!-- ‚ù§Ô∏è Heart + message section FIRST -->
      <div class="content">
        <div>
          <div class="message-bubble">
            <p id="messageText" class="message-text"></p>
            <div class="message-meta">
              <span>‚ù§Ô∏è Clicks: <strong id="clickCount">0</strong></span>
              <span id="timestamp"></span>
            </div>

            <!-- Love level meter -->
            <div class="love-meter">
              <div class="love-meter-top">
                <span class="love-meter-label">Love level</span>
                <span id="loveLevelText" class="love-meter-value">Level 1</span>
              </div>
              <div class="love-meter-bar">
                <div id="loveLevelFill" class="love-meter-fill"></div>
              </div>
            </div>
          </div>

          <p class="hint-line">
            Every tap is one extra ‚ÄúI love you‚Äù from my heart to yours. üíó
          </p>
        </div>

        <div class="heart-panel">
          <button class="heart-button" id="heartButton" type="button" aria-label="Show next love message">
            <svg class="heart-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <defs>
                <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#ffe1f0"/>
                  <stop offset="50%" stop-color="#ff4b8a"/>
                  <stop offset="100%" stop-color="#b3125d"/>
                </linearGradient>
              </defs>
              <path
                d="M47.5 8C41.9 8 37.3 11.3 32 18.3 26.7 11.3 22.1 8 16.5 8 9.1 8 4 13.6 4 21.4 4 34.4 17.4 43.8 30.7 54.7 31.3 55.2 31.7 55.6 32 55.9 32.3 55.6 32.7 55.2 33.3 54.7 46.6 43.8 60 34.4 60 21.4 60 13.6 54.9 8 47.5 8Z"
                fill="url(#heartGradient)"
              />
            </svg>
          </button>
          <div class="heart-hint">
            Tap the heart to see the next note üíû
          </div>
        </div>
      </div>

      <!-- Then Nikah / Marriage / Birthday section -->
      <div class="special-dates">
        <div class="dates-row">
          <div class="date-item">üìø Nikah Day ‚Äî <b>10 November</b></div>
          <div class="date-item">üíç Marriage Day ‚Äî <b>20 October</b></div>
          <div class="date-item">üéÇ Birthday ‚Äî <b>24 December</b></div>
        </div>
        <div class="love-counter" id="loveCounter"></div>
        <div class="love-timeline">
          <div class="timeline-track">
            <div class="timeline-heart">üíó</div>
          </div>
          <div class="timeline-labels">
            <span>Nikah</span>
            <span>Marriage</span>
            <span>Birthday</span>
          </div>
        </div>

        <!-- üîÆ Upcoming event box (filled by JS) -->
        <div id="upcomingEvent" class="upcoming-event" aria-live="polite"></div>
      </div>

      <div class="footer-note">
        <span>Made with üíñ <b>all my love</b> for you</span>
        <span id="miniNote"></span>
      </div>
    </section>
  </main>

  <script>
    // üíå Customize these love messages for ZA if you like
    const loveMessages = [
      "golu, you are not just my wife ‚Äî you are my favourite human in this entire world.",
      "Your smile is my sunrise, and your voice is my favourite sound.",
      "If I had to choose you again, I‚Äôd still choose you in every lifetime, every time.",
      "You make normal days feel like beautiful little miracles.",
      "My safest place will always be the space next to you.",
      "I fall in love with you a little more every time you look at me.",
      "No matter how hard the day is, one thought of you makes it soft again.",
      "You are my calm, my chaos, my home, and my forever all at once.",
      "I don‚Äôt need a perfect life ‚Äî I just need a life with you in it.",
      "You are my favourite blessing, my favourite story, and my favourite ‚Äúalways‚Äù."
    ];

    function shuffle(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    let messageQueue = shuffle(loveMessages);
    let clickCount = 0;

    // Typewriter state
    let isTyping = false;
    let typingTimeoutId = null;
    let currentFullMessage = "";

    const messageTextEl = document.getElementById("messageText");
    const clickCountEl = document.getElementById("clickCount");
    const timestampEl = document.getElementById("timestamp");
    const heartButton = document.getElementById("heartButton");
    const bgHearts = document.getElementById("bgHearts");
    const miniNote = document.getElementById("miniNote");
    const themeToggle = document.getElementById("themeToggle");
    const loveCounterEl = document.getElementById("loveCounter");
    const fireworksContainer = document.getElementById("fireworks");
    const upcomingEventEl = document.getElementById("upcomingEvent");
    const greetingLineEl = document.getElementById("greetingLine");
    const loveLevelTextEl = document.getElementById("loveLevelText");
    const loveLevelFillEl = document.getElementById("loveLevelFill");

    // Web Audio click sound (no external file)
    let audioCtx = null;
    function playClickSound() {
      try {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        const ctx = audioCtx;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        const now = ctx.currentTime;
        const duration = 0.08; // 80 ms

        osc.type = "square";
        osc.frequency.setValueAtTime(3200, now);

        gain.gain.setValueAtTime(0.6, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.start(now);
        osc.stop(now + duration);
      } catch (e) {
        // ignore if audio blocked
      }
    }

    // Base marriage date (first time)
    const marriageDate = new Date(2024, 9, 20); // 20 October 2024

    // Special events (yearly)
    const specialEvents = [
      {
        key: "nikah",
        label: "Nikah Day",
        icon: "üìø",
        month: 11 - 1, // November (0-based)
        day: 10
      },
      {
        key: "marriage",
        label: "Marriage Anniversary",
        icon: "üíç",
        month: 10 - 1, // October (0-based)
        day: 20
      },
      {
        key: "birthday",
        label: "Birthday",
        icon: "üéÇ",
        month: 12 - 1, // December (0-based)
        day: 24
      }
    ];

    // Birthday (for fireworks ‚Äì only month/day checked)
    const birthdayMonth = 11; // December (0-based)
    const birthdayDay = 24;

    const monthNames = [
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    ];

    function formatTime(date) {
      const options = { hour: "2-digit", minute: "2-digit" };
      return date.toLocaleTimeString([], options);
    }

    function updateThemeToggleText() {
      const isNight = document.body.classList.contains("theme-night");
      themeToggle.textContent = isNight ? "‚òÄ Day mode" : "üåô Night mode";
    }

    function updateGreetingLine() {
      if (!greetingLineEl) return;
      const now = new Date();
      const hour = now.getHours();
      let text = "Good evening, my love.";

      if (hour >= 5 && hour < 12) {
        text = "Good morning, my love. üåÖ";
      } else if (hour >= 12 && hour < 17) {
        text = "Good afternoon, my love. üå∏";
      } else if (hour >= 17 && hour < 22) {
        text = "Good evening, my love. üåô";
      } else {
        text = "Can‚Äôt sleep without loving you a little more. üåå";
      }

      greetingLineEl.textContent = text;
    }

    function updateLoveMeter() {
      if (!loveLevelTextEl || !loveLevelFillEl) return;

      const level = Math.max(1, Math.floor(clickCount / 20) + 1);
      const withinLevel = clickCount % 20;
      const percent = Math.min((withinLevel / 20) * 100, 100);

      let labelSuffix = "";
      if (level === 1) labelSuffix = "‚Äì just getting started";
      else if (level === 2) labelSuffix = "‚Äì kinda obsessed";
      else if (level === 3) labelSuffix = "‚Äì fully addicted to you";
      else if (level === 4) labelSuffix = "‚Äì heart belongs to you";
      else labelSuffix = "‚Äì beyond infinity üíû";

      loveLevelTextEl.textContent = `Level ${level} ${labelSuffix}`;
      loveLevelFillEl.style.width = percent + "%";

      if (percent >= 99) {
        loveLevelFillEl.classList.add("full");
      } else {
        loveLevelFillEl.classList.remove("full");
      }
    }

    // ‚ú® Typewriter: actually types the message
    function typeMessage(text) {
      isTyping = true;
      currentFullMessage = text;

      // reset content + classes
      if (typingTimeoutId) {
        clearTimeout(typingTimeoutId);
        typingTimeoutId = null;
      }
      messageTextEl.textContent = "";
      messageTextEl.classList.add("visible", "typing");

      let index = 0;
      const speed = 35; // ms per character

      function step() {
        if (!isTyping) return; // typing was cancelled
        if (index < text.length) {
          messageTextEl.textContent += text.charAt(index);
          index++;
          typingTimeoutId = setTimeout(step, speed);
        } else {
          finishTyping();
        }
      }

      step();
    }

    // Finish typing instantly (used when clicking again)
    function finishTyping() {
      if (typingTimeoutId) {
        clearTimeout(typingTimeoutId);
        typingTimeoutId = null;
      }
      if (currentFullMessage !== null) {
        messageTextEl.textContent = currentFullMessage;
      }
      isTyping = false;
      messageTextEl.classList.remove("typing");
    }

    // ‚ù§Ô∏è Show next message (with typewriter)
    function showNextMessage() {
      if (messageQueue.length === 0) {
        messageQueue = shuffle(loveMessages);
      }

      const nextMessage = messageQueue.shift();
      clickCount++;

      // update stats & storage
      clickCountEl.textContent = clickCount.toString();
      timestampEl.textContent = "Last tap: " + formatTime(new Date());
      try {
        localStorage.setItem("loveSite_clickCount", String(clickCount));
        localStorage.setItem("loveSite_lastMessage", nextMessage);
      } catch (e) {}

      messageTextEl.classList.remove("visible", "typing");

      // pulse heart + sound + meter
      pulseHeart();
      playClickSound();
      updateLoveMeter();

      // start typing new message
      typeMessage(nextMessage);
    }

    function pulseHeart() {
      const icon = document.querySelector(".heart-icon");
      icon.classList.remove("heart-pulse");
      void icon.offsetWidth;
      icon.classList.add("heart-pulse");
    }

    function spawnFloatingHeart(x, y) {
      const heart = document.createElement("div");
      heart.className = "floating-heart";
      heart.textContent = "üíó";
      heart.style.left = x + "px";
      heart.style.top = y + "px";

      document.body.appendChild(heart);
      heart.addEventListener("animationend", () => heart.remove());
    }

    function initBackgroundHearts() {
      const count = 16;
      for (let i = 0; i < count; i++) {
        const span = document.createElement("span");
        span.className = "bg-heart-shape";
        span.textContent = "‚ù§";

        span.style.left = Math.random() * 100 + "%";
        span.style.animationDelay = -Math.random() * 18 + "s";
        span.style.opacity = (0.4 + Math.random() * 0.35).toString();

        bgHearts.appendChild(span);
      }
    }

    function updateLoveCounter() {
      if (!loveCounterEl || !(marriageDate instanceof Date)) return;

      const today = new Date();
      const start = new Date(marriageDate.getFullYear(), marriageDate.getMonth(), marriageDate.getDate());
      const now = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const diffMs = now - start;
      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));

      if (days >= 0) {
        loveCounterEl.textContent = `We have been married for ${days} day${days !== 1 ? "s" : ""} so far üíû`;
      } else {
        loveCounterEl.textContent = `Our marriage day is coming soon, and my heart is already waiting. üíû`;
      }
    }

    // üîÆ Find next upcoming special event (Nikah, Marriage, Birthday)
    function getNextUpcomingEvent() {
      const today = new Date();
      const todayMidnight = new Date(today.getFullYear(), today.getMonth(), today.getDate());

      let best = null;

      for (const ev of specialEvents) {
        let year = today.getFullYear();
        let eventDate = new Date(year, ev.month, ev.day);

        if (eventDate < todayMidnight) {
          year++;
          eventDate = new Date(year, ev.month, ev.day);
        }

        const diffMs = eventDate - todayMidnight;
        const daysLeft = Math.round(diffMs / (1000 * 60 * 60 * 24));

        if (best === null || daysLeft < best.daysLeft) {
          best = {
            ...ev,
            date: eventDate,
            daysLeft
          };
        }
      }

      return best;
    }

    function updateUpcomingEventBox() {
      if (!upcomingEventEl) return;

      const upcoming = getNextUpcomingEvent();
      if (!upcoming) {
        upcomingEventEl.textContent = "";
        return;
      }

      const { icon, label, date, daysLeft } = upcoming;
      const day = date.getDate();
      const monthName = monthNames[date.getMonth()];

      let title, mainLine, countLine;
      let soonBadge = "";

      if (daysLeft === 0) {
        upcomingEventEl.classList.add("today");
        title = `${icon} Today is our special day!`;
        mainLine = `${label} is TODAY, my love.`;
        countLine = "Let‚Äôs make every second of it memorable. üíû";
      } else if (daysLeft === 1) {
        upcomingEventEl.classList.remove("today");
        title = `${icon} Coming tomorrow`;
        mainLine = `${label} is almost here ‚Äî ${day} ${monthName}.`;
        countLine = `Only 1 day left, and my heart is already excited. ü´∂`;
        soonBadge = `<span class="upcoming-soon">very soon</span>`;
      } else {
        upcomingEventEl.classList.remove("today");
        title = `${icon} Next special day`;
        mainLine = `${label} is on ${day} ${monthName}.`;
        countLine = `Only ${daysLeft} days left until we celebrate again. ‚ú®`;
        if (daysLeft <= 7) {
          soonBadge = `<span class="upcoming-soon">very soon</span>`;
        }
      }

      upcomingEventEl.innerHTML = `
        <div class="upcoming-title">
          <span>${title}</span>
          ${soonBadge}
        </div>
        <div class="upcoming-main">${mainLine}</div>
        <div class="upcoming-count">${countLine}</div>
      `;
    }

    function initFireworks() {
      if (!fireworksContainer) return;
      fireworksContainer.innerHTML = "";
      const count = 6;
      for (let i = 0; i < count; i++) {
        const fw = document.createElement("div");
        fw.className = "firework";
        fw.style.left = (15 + Math.random() * 70) + "%";
        fw.style.top = (20 + Math.random() * 55) + "%";
        fw.style.animationDelay = (Math.random() * 0.8) + "s";
        fireworksContainer.appendChild(fw);
      }
    }

    function checkBirthdayEffects() {
      const today = new Date();
      if (today.getMonth() === birthdayMonth && today.getDate() === birthdayDay) {
        document.body.classList.add("birthday-today");
        initFireworks();
      }
    }

    function restoreState() {
      try {
        const lastMessage = localStorage.getItem("loveSite_lastMessage");
        const storedClicks = localStorage.getItem("loveSite_clickCount");
        const savedTheme = localStorage.getItem("loveSite_theme");

        if (storedClicks) {
          clickCount = parseInt(storedClicks, 10) || 0;
          clickCountEl.textContent = clickCount.toString();
        }

        if (lastMessage) {
          currentFullMessage = lastMessage;
          messageTextEl.textContent = lastMessage;
          messageTextEl.classList.add("visible");
        } else {
          // first time: show first message with typing
          showNextMessage();
        }

        if (savedTheme === "night") {
          document.body.classList.add("theme-night");
        }
      } catch (e) {
        // ignore localStorage errors
        showNextMessage();
      }

      updateThemeToggleText();
      updateLoveMeter();
    }

    function setMiniNote() {
      const year = new Date().getFullYear();
      miniNote.textContent = `Love engine running since ${year}.`;
    }

    // ‚ù§Ô∏è Heart click handler with "skip typing" behaviour
    function handleHeartClick() {
      if (isTyping) {
        // If it's still typing, finish instantly instead of going to next
        finishTyping();
      } else {
        showNextMessage();
      }

      const rect = heartButton.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;
      spawnFloatingHeart(x, y);
    }

    heartButton.addEventListener("click", handleHeartClick);

    heartButton.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === " ") {
        event.preventDefault();
        handleHeartClick();
      }
    });

    document.addEventListener("click", (event) => {
      const isHeartButton = heartButton.contains(event.target);
      if (!isHeartButton) {
        spawnFloatingHeart(event.clientX, event.clientY);
      }
    });

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("theme-night");
      updateThemeToggleText();
      try {
        const mode = document.body.classList.contains("theme-night") ? "night" : "day";
        localStorage.setItem("loveSite_theme", mode);
      } catch (e) {}
    });

    // Init
    initBackgroundHearts();
    setMiniNote();
    updateLoveCounter();
    restoreState();
    checkBirthdayEffects();
    updateUpcomingEventBox();
    updateGreetingLine();
  </script>
</body>
</html>
